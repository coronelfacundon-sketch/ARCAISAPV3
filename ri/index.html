<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ARCA · Responsable Inscripto (Simulación)</title>
<style>
:root{--pri:#0d5c63;--pri2:#157a85;--bg:#f5f8fa;--card:#fff;--txt:#132;--shadow:0 10px 28px rgba(0,0,0,.08);--err:#b00020}
*{box-sizing:border-box}body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--txt)}
header{background:linear-gradient(135deg,var(--pri),var(--pri2));color:#fff;padding:24px 18px}
.wrap{max-width:1100px;margin:0 auto;padding:18px}h1{margin:0;font-size:26px;font-weight:800}.sub{opacity:.9;margin-top:6px}
nav .nav{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
nav .nav a{color:#fff;text-decoration:none;background:#0b5a61;padding:8px 12px;border-radius:10px;font-weight:700}
.card{background:var(--card);border-radius:16px;padding:18px;box-shadow:var(--shadow)}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px}
.col-4{grid-column:span 4}.col-6{grid-column:span 6}.col-12{grid-column:span 12}
@media(max-width:820px){.col-6,.col-4{grid-column:span 12}}
label{font-weight:650;font-size:14px}
input,select{width:100%;padding:11px;border:1px solid #d6e1e6;border-radius:12px;background:#fbfeff;margin-top:6px}
.btn{border:0;border-radius:12px;padding:12px 16px;font-weight:800;cursor:pointer}
.btn.p{background:#0d5c63;color:#fff}.btn.s{background:#e9f1f3}
.stepbar{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 16px}
.step{flex:1 1 140px;background:#e7eff1;border-radius:12px;padding:8px 10px;display:flex;gap:8px;align-items:center}
.step.on{background:#d1eef1;border:1px solid #9ad5db}.n{background:#0d5c63;color:#fff;border-radius:10px;padding:2px 8px;font-weight:800}
.err{display:none;color:#fff;background:#b00020;padding:6px 10px;border-radius:10px;margin-top:8px}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>ARCA – Simulación Educativa</h1>
    <div class="sub">Responsable Inscripto — BA o CABA · IIBB ARBA/AGIP · Altas de impuestos</div>
    <nav><div class="nav"><a href="../">Inicio</a><a href="../monotributo/">Monotributista</a><a href="../ri/">Responsable Inscripto</a><a href="../empleados/">Empleados</a></div></nav>
  </div>
</header>

<main class="wrap">
  <section class="card">
    <div id="steps" class="stepbar"></div>

    <!-- Paso 1 -->
    <section class="panel" data-step="0">
      <h2>1) Identificación</h2>
      <div class="grid">
        <div class="col-6"><label>Apellido</label><input id="ap"></div>
        <div class="col-6"><label>Nombre</label><input id="no"></div>
        <div class="col-4"><label>Tipo doc.</label><select id="td"><option>DNI</option><option>LE</option><option>LC</option></select></div>
        <div class="col-4"><label>N° doc (ficticio)</label><input id="nd" maxlength="9"></div>
        <div class="col-4"><label>CUIT/CUIL (simulado)</label><input id="cu" maxlength="11"></div>
        <div class="col-6"><label>Email</label><input id="em"></div>
        <div class="col-6"><label>Teléfono</label><input id="te" inputmode="numeric" pattern="\d*"></div>
      </div>
      <div class="err" data-for="0"></div>
      <div class="actions" style="display:flex;gap:10px;justify-content:flex-end;margin-top:14px">
        <button class="btn p" onclick="next()">Continuar</button>
      </div>
    </section>

    <!-- Paso 2 -->
    <section class="panel" data-step="1" hidden>
      <h2>2) Domicilios</h2>
      <div class="grid">
        <div class="col-6"><label>Calle</label><input id="ca"></div>
        <div class="col-3"><label>Número</label><input id="nu"></div>
        <div class="col-3"><label>Piso/Depto</label><input id="pi"></div>
        <div class="col-5"><label>Localidad</label><input id="lo"></div>
        <div class="col-4"><label>Provincia</label><select id="pr"><option>Buenos Aires</option><option>CABA</option></select></div>
        <div class="col-3"><label>CP</label><input id="pc" maxlength="8"></div>
      </div>
      <div class="err" data-for="1"></div>
      <div class="actions" style="display:flex;gap:10px;justify-content:flex-end;margin-top:14px">
        <button class="btn s" onclick="prev()">Atrás</button>
        <button class="btn p" onclick="next()">Continuar</button>
      </div>
    </section>

    <!-- Paso 3 -->
    <section class="panel" data-step="2" hidden>
      <h2>3) Actividad e IIBB</h2>
      <div class="grid">
        <div class="col-6"><label>Actividad principal (NAES)</label><select id="ac"><option value="620100">620100 — Servicios de software</option><option value="471130">471130 — Venta minorista</option><option value="561020">561020 — Gastronomía</option></select></div>
        <div class="col-6"><label>Fecha inicio</label><input id="fi"></div>
        <div class="col-4"><label>Condición IIBB</label><select id="ii"><option>Local (única jurisdicción)</option><option>Convenio Multilateral</option></select></div>
        <div class="col-4"><label>Código IIBB</label><input id="ic"></div>
        <div class="col-4"><label>Fecha alta IIBB</label><input id="ia"></div>
        <div class="col-6" id="cmb" hidden><label>Jurisdicción principal (CM)</label><select id="jp"><option>Buenos Aires</option><option>CABA</option></select></div>
        <div class="col-6"><label>DFE (simulado)</label><select id="df"><option>No</option><option>Sí</option></select></div>
      </div>
      <div class="err" data-for="2"></div>
      <div class="actions" style="display:flex;gap:10px;justify-content:flex-end;margin-top:14px">
        <button class="btn s" onclick="prev()">Atrás</button>
        <button class="btn p" onclick="next()">Continuar</button>
      </div>
    </section>

    <!-- Paso 4 -->
    <section class="panel" data-step="3" hidden>
      <h2>4) Altas de Impuestos / Regímenes</h2>
      <div class="grid">
        <div class="col-6"><label>Canal utilizado</label><select id="canal"><option>RUT</option><option>Sistema Registral</option></select></div>
        <div class="col-6"><label>Fecha de alta general</label><input id="fr"></div>
        <div class="col-12"><label><input type="checkbox" id="iva"> IVA</label></div>
        <div class="col-12"><label><input type="checkbox" id="gan"> Ganancias</label></div>
        <div class="col-6"><label><input type="checkbox" id="aut"> Autónomos</label></div>
        <div class="col-6"><label>Cat. Autónomos (si corresponde)</label><input id="autcat" placeholder="Ej.: II, III"></div>
        <div class="col-12"><label><input type="checkbox" id="emp"> Empleador</label></div>
        <div class="col-12"><label><input type="checkbox" id="bp"> Bienes Personales</label></div>
        <div class="col-12"><label><input type="checkbox" id="ced"> Cedulares</label></div>
      </div>
      <div class="actions" style="display:flex;gap:10px;justify-content:flex-end;margin-top:14px">
        <button class="btn s" onclick="prev()">Atrás</button>
        <button class="btn p" onclick="next()">Revisar</button>
      </div>
    </section>

    <!-- Paso 5 -->
    <section class="panel" data-step="4" hidden>
      <h2>Revisión y confirmación</h2>
      <div id="rev" class="card" style="border:1px dashed #9ad5db;background:#f2fbfd"></div>
      <label style="display:flex;gap:8px;align-items:flex-start;margin-top:10px"><input id="ok" type="checkbox"> <span>Declaro que los datos son ficticios y para uso educativo.</span></label>
      <div class="err" data-for="4"></div>
      <div class="actions" style="display:flex;gap:10px;justify-content:flex-end;margin-top:14px">
        <button class="btn s" onclick="prev()">Atrás</button>
        <button class="btn p" onclick="confirmar()">Confirmar alta (simulada)</button>
      </div>
    </section>

    <!-- Paso 6 -->
    <section class="panel" data-step="5" hidden>
      <h2>Constancia de Alta — Simulación</h2>
      <div id="const" class="card"></div>
      <div class="actions" style="display:flex;gap:10px;justify-content:flex-end;margin-top:14px">
        <button class="btn p" onclick="window.print()">Imprimir / PDF</button>
        <button class="btn s" onclick="exportXLS()">Descargar datos_RI.xls</button>
        <a class="btn s" href="../">Volver al inicio</a>
      </div>
    </section>
  </section>
</main>

<script>
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
let STEP=0, S={};const REGS=JSON.parse(localStorage.getItem('arca_ri_regs_v2')||'[]');
function steps(){const t=["Identificación","Domicilios","Actividad/IIBB","Regímenes","Revisión","Constancia"];$("#steps").innerHTML=t.map((x,i)=>`<div class="step ${i===STEP?'on':''}"><span class="n">${i+1}</span> ${x}</div>`).join('')}
function show(n){STEP=n;steps();$$(".panel").forEach(p=>p.hidden=(+p.dataset.step!==n));if(n===4)renderRev();if(n===5)renderConst();window.scrollTo({top:0,behavior:"smooth"})}
function next(){if(validate(STEP))show(STEP+1)}function prev(){show(Math.max(0,STEP-1))}
$("#ii").addEventListener('change',()=>{$("#cmb").hidden=($("#ii").value!=="Convenio Multilateral")});

function parseD(s){if(!s)return null;let m=s.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})$/);if(m){const d=new Date(+m[3],+m[2]-1,+m[1]);return isNaN(d)?null:d}m=s.match(/^(\d{4})[\/\-](\d{1,2})[\/\-](\d{1,2})$/);if(m){const d=new Date(+m[1],+m[2]-1,+m[3]);return isNaN(d)?null:d}const d=new Date(s);return isNaN(d)?null:d}
function cpOK(v,p){return p==="Buenos Aires"?/^\d{4}$/.test(v):/^\d{4}([A-Za-z]{3})?$/.test(v)||/^[A-Z]\d{4}[A-Z]{3}$/.test(v)}
function err(n,m){const e=$(`.err[data-for="${n}"]`);if(!e)return;if(m){e.textContent=m;e.style.display="inline-block"}else e.style.display="none"}

function validate(n){
  err(n,"");
  if(n===0){
    const tests=[["ap",v=>!!v,"Apellido"],["no",v=>!!v,"Nombre"],["nd",v=>/^\d{7,9}$/.test(v),"Doc 7–9 díg"],["cu",v=>!v||/^\d{11}$/.test(v),"CUIT 11 díg (opcional)"],["em",v=>/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(v),"Email inválido"],["te",v=>v.replace(/\D/g,"").length>=6,"Teléfono inválido"]];
    for(const [id,fn,lbl] of tests){const v=$("#"+id).value.trim();if(!fn(v)){err(0,"Revisá: "+lbl);$("#"+id).focus();return false}}
    Object.assign(S,{ap:ap.value,no:no.value,td:td.value,nd:nd.value,cu:cu.value,em:em.value.toLowerCase(),te:te.value});
  }
  if(n===1){
    const p=pr.value, tests=[["ca",v=>!!v,"Calle"],["nu",v=>/^\d{1,6}$/.test(v),"Número"],["lo",v=>!!v,"Localidad"],["pc",v=>cpOK(v,p),"CP"]];
    for(const [id,fn,lbl] of tests){const v=$("#"+id).value.trim();if(!fn(v)){err(1,"Revisá: "+lbl);$("#"+id).focus();return false}}
    Object.assign(S,{ca:ca.value,nu:nu.value,pi:pi.value,lo:lo.value,pr:pr.value,pc:pc.value});
  }
  if(n===2){
    if(!parseD(fi.value)) return err(2,"Fecha de inicio inválida"),false;
    if(!ic.value) return err(2,"Código IIBB requerido"),false;
    if(!parseD(ia.value)) return err(2,"Fecha alta IIBB inválida"),false;
    if(ii.value==="Convenio Multilateral"&&!jp.value) return err(2,"Elegí jurisdicción principal"),false;
    Object.assign(S,{ac:ac.value,fi:fi.value,ii:ii.value,ic:ic.value,ia:ia.value,jp:jp.value||"",df:df.value});
  }
  if(n===3){
    Object.assign(S,{canal:canal.value,fr:fr.value||"",iva:iva.checked,gan:gan.checked,aut:aut.checked,autcat:autcat.value||"",emp:emp.checked,bp:bp.checked,ced:ced.checked});
  }
  return true;
}

function renderRev(){
  $("#rev").innerHTML=`
    <b>${S.ap||''}, ${S.no||''}</b> — ${S.td||''} ${S.nd||''}${S.cu?(' — CUIT '+S.cu):''}<br>
    <b>Domicilio:</b> ${S.ca||''} ${S.nu||''} ${S.pi||''}, ${S.lo||''}, ${S.pr||''} (${S.pc||''})<br>
    <b>Actividad:</b> ${S.ac||''} — Inicio: ${S.fi||''}<br>
    <b>IIBB:</b> ${S.ii||''} ${S.jp?('('+S.jp+')'):''} — Cód: ${S.ic||''} — Alta: ${S.ia||''} — DFE: ${S.df||'No'}<br>
    <b>Canal:</b> ${S.canal||''} — <b>Regímenes:</b> IVA ${S.iva?'Sí':'No'} · Ganancias ${S.gan?'Sí':'No'} · Autónomos ${S.aut?'Sí':'No'} ${S.autcat?('(Cat '+S.autcat+')'):''} · Empleador ${S.emp?'Sí':'No'} · BP ${S.bp?'Sí':'No'} · Cedulares ${S.ced?'Sí':'No'}
  `;
}

function confirmar(){
  if(!ok.checked){err(4,"Debés aceptar la declaración.");return}
  const row=Object.assign({fecha:new Date().toLocaleString("es-AR"),tipo:"RI"},S);
  REGS.push(row);localStorage.setItem('arca_ri_regs_v2',JSON.stringify(REGS));show(5);
}

function renderConst(){
  $("#const").innerHTML=`
    <b>ARCA – Constancia de Alta (RI, simulada)</b><br><br>
    <b>Contribuyente:</b> ${S.ap||''}, ${S.no||''} — ${S.td||''} ${S.nd||''}${S.cu?(' — CUIT '+S.cu):''}<br>
    <b>Domicilio:</b> ${S.ca||''} ${S.nu||''} ${S.pi||''}, ${S.lo||''}, ${S.pr||''} (${S.pc||''})<br>
    <b>Actividad:</b> ${S.ac||''} — Inicio: ${S.fi||''}<br>
    <b>IIBB:</b> ${S.ii||''} ${S.jp?('('+S.jp+')'):''} — Cód: ${S.ic||''} — Alta: ${S.ia||''} — DFE: ${S.df||'No'}<br>
    <b>Canal:</b> ${S.canal||''}<br>
    <b>Regímenes:</b> IVA ${S.iva?'Sí':'No'} · Ganancias ${S.gan?'Sí':'No'} · Autónomos ${S.aut?'Sí':'No'} ${S.autcat?('(Cat '+S.autcat+')'):''} · Empleador ${S.emp?'Sí':'No'} · BP ${S.bp?'Sí':'No'} · Cedulares ${S.ced?'Sí':'No'}<br>
    <b>Fecha emisión:</b> ${new Date().toLocaleString("es-AR")}
  `;
}

function exportXLS(){
  const HEAD=["fecha","ap","no","td","nd","cu","em","te","ca","nu","pi","lo","pr","pc","ac","fi","ii","ic","ia","jp","df","canal","fr","iva","gan","aut","autcat","emp","bp","ced"];
  const esc=s=>String(s??"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
  const data=JSON.parse(localStorage.getItem('arca_ri_regs_v2')||'[]');
  const rows=data.map(r=>"<tr>"+HEAD.map(k=>`<td>${esc(r[k])}</td>`).join("")+"</tr>").join("");
  const html=`<!DOCTYPE html><meta charset="utf-8"><table border="1"><thead><tr>${HEAD.map(h=>`<th>${h}</th>`).join("")}</tr></thead><tbody>${rows}</tbody></table>`;
  const url=URL.createObjectURL(new Blob([html],{type:"application/vnd.ms-excel"})), a=document.createElement("a");
  a.href=url;a.download="datos_RI.xls";a.click();URL.revokeObjectURL(url);
}

function init(){steps();show(0)}init();
</script>
</body>
</html>
