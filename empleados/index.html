<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ARCA · Empleados (simulado)</title>
<style>
:root{--pri:#0d5c63;--pri2:#157a85;--bg:#f5f8fa;--card:#fff;--txt:#132;--shadow:0 10px 28px rgba(0,0,0,.08)}
*{box-sizing:border-box}body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--txt)}
header{background:linear-gradient(135deg,var(--pri),var(--pri2));color:#fff;padding:24px 18px}
.wrap{max-width:1200px;margin:0 auto;padding:18px}
h1{margin:0;font-size:26px;font-weight:800}.sub{opacity:.9;margin-top:6px}
nav .nav{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
nav .nav a{color:#fff;text-decoration:none;background:#0b5a61;padding:8px 12px;border-radius:10px;font-weight:700}
.card{background:var(--card);border-radius:16px;padding:18px;box-shadow:var(--shadow)}
.toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:10px}
input,select{padding:10px;border:1px solid #d6e1e6;border-radius:10px;background:#fbfeff}
table{width:100%;border-collapse:collapse}
th,td{border-bottom:1px solid #e6eef1;padding:10px;text-align:left;font-size:14px}
.badge{display:inline-block;background:#e6f6ef;color:#10634e;border-radius:999px;padding:4px 8px;font-size:12px;font-weight:800}
.btn{border:0;border-radius:10px;padding:8px 12px;font-weight:800;cursor:pointer}
.btn.p{background:#0d5c63;color:#fff}.btn.s{background:#e9f1f3}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;place-items:center;z-index:10}
.mbox{background:#fff;border-radius:16px;max-width:540px;width:94vw;padding:16px;box-shadow:var(--shadow)}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>ARCA – Simulación Educativa</h1>
    <div class="sub">Panel de empleados — ver Monotributistas y Responsables Inscriptos</div>
    <nav><div class="nav"><a href="../">Inicio</a><a href="../monotributo/">Monotributista</a><a href="../ri/">Responsable Inscripto</a><a href="../empleados/">Empleados</a></div></nav>
  </div>
</header>

<main class="wrap">
  <section class="card">
    <div class="toolbar">
      <input id="q" placeholder="Buscar por nombre, apellido, CUIT…" oninput="render()">
      <select id="tipo" onchange="render()">
        <option value="">Todos</option>
        <option value="MT">Monotributista</option>
        <option value="RI">Resp. Inscripto</option>
      </select>
      <button class="btn s" onclick="exportCSV()">Exportar CSV</button>
      <button class="btn s" onclick="exportXLS()">Exportar XLS</button>
    </div>
    <div id="tabla"></div>
  </section>
</main>

<!-- Modal login -->
<div id="login" class="modal">
  <div class="mbox">
    <div style="display:flex;justify-content:space-between;align-items:center"><b>ARCA · Acceso empleados (simulado)</b><span></span></div>
    <p style="margin:8px 0 12px 0;color:#456">Uso pedagógico. No hay servidores ni datos reales.</p>
    <label>Usuario</label><input id="u" style="width:100%;margin-top:6px" placeholder="ARCA">
    <label style="display:block;margin-top:10px">Clave</label><input id="p" style="width:100%;margin-top:6px" type="password" placeholder="ARCAISAP123">
    <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:12px"><button class="btn p" onclick="go()">Ingresar</button></div>
    <div id="e" style="display:none;margin-top:8px;background:#b00020;color:#fff;padding:6px 10px;border-radius:10px">Credenciales incorrectas</div>
  </div>
</div>

<script>
const $=s=>document.querySelector(s);
function openLogin(){ $("#login").style.display="grid" }
function go(){ const ok=($("#u").value.trim().toUpperCase()==="ARCA" && $("#p").value==="ARCAISAP123"); if(!ok){$("#e").style.display="block";return} $("#login").style.display="none"; load() }
function load(){
  const mt=(JSON.parse(localStorage.getItem('arca_mono_regs_v3')||'[]')).map(x=>({tipo:"MT",apellido:x.apellido||"",nombre:x.nombre||"",cuit:x.cuit||"",doc:(x.tipoDoc||"")+" "+(x.nroDoc||""),email:x.email||"",tel:x.tel||x.telefono||"",actividad:x.act||"",iibb:(x.iibb||"")+(x.cm?(" ("+x.cm+")"):""),fecha:x.fechaRegistro||"",raw:x}));
  const ri=(JSON.parse(localStorage.getItem('arca_ri_regs_v2')||'[]')).map(x=>({tipo:"RI",apellido:x.ap||"",nombre:x.no||"",cuit:x.cu||"",doc:(x.td||"")+" "+(x.nd||""),email:x.em||"",tel:x.te||"",actividad:x.ac||"",iibb:(x.ii||"")+(x.jp?(" ("+x.jp+")"):""),fecha:x.fecha||"",raw:x}));
  window._rows=[...mt,...ri];
  render();
}
function render(){
  const q=$("#q").value.toLowerCase(), t=$("#tipo").value;
  const rows=(window._rows||[]).filter(r=>{
    const hay=(r.apellido+" "+r.nombre+" "+r.cuit).toLowerCase().includes(q);
    const okTipo=!t||r.tipo===t;
    return hay&&okTipo;
  });
  const html=`<table><thead><tr><th>Tipo</th><th>Apellido</th><th>Nombre</th><th>CUIT</th><th>Doc</th><th>Actividad</th><th>IIBB</th><th>Fecha</th><th>Acciones</th></tr></thead><tbody>
    ${rows.map((r,i)=>`<tr><td>${r.tipo}</td><td>${r.apellido}</td><td>${r.nombre}</td><td>${r.cuit}</td><td>${r.doc}</td><td>${r.actividad}</td><td>${r.iibb}</td><td>${r.fecha}</td><td><button class="btn s" onclick='ver(${i})'>Ver constancia</button></td></tr>`).join("")}
  </tbody></table>`;
  $("#tabla").innerHTML=html;
}
function ver(idx){
  const r=(window._rows||[])[idx]; if(!r) return;
  let body="";
  if(r.tipo==="MT"){
    const S=r.raw, ag=S.prov==="Buenos Aires"?"ARBA":"AGIP";
    const adh=(S.adh?S.adh:JSON.parse(S.adhJSON||"[]")).map(a=>`${a.cuil||'-'} (${a.vinc||'-'})`).join(', ');
    body=`<div class="card"><b>Constancia MT (simulada)</b><br><br>
    <b>Contribuyente:</b> ${S.apellido||''}, ${S.nombre||''} — ${S.tipoDoc||''} ${S.nroDoc||''}${S.cuit?(' — CUIT '+S.cuit):''}<br>
    <b>Actividad:</b> ${S.act||''} — Inicio: ${S.inicio||''}<br>
    <b>IIBB ${ag}:</b> ${S.iibb||''} ${S.cm?('('+S.cm+')'):''} — Cód: ${S.iibbCod||''} — Alta: ${S.iibbAlta||''} — DFE: ${S.dfe?'Sí':'No'} — RS: ${S.rs||'No'}<br>
    <b>Obra social:</b> ${S.sinOS?'Sin obra social':(S.os||'-')} — <b>Adherentes:</b> ${adh||'-'}<br>
    <b>Fecha registro:</b> ${S.fechaRegistro||'-'}
    </div>`;
  }else{
    const S=r.raw;
    body=`<div class="card"><b>Constancia RI (simulada)</b><br><br>
    <b>Contribuyente:</b> ${S.ap||''}, ${S.no||''} — ${S.td||''} ${S.nd||''}${S.cu?(' — CUIT '+S.cu):''}<br>
    <b>Actividad:</b> ${S.ac||''} — Inicio: ${S.fi||''}<br>
    <b>IIBB:</b> ${S.ii||''} ${S.jp?('('+S.jp+')'):''} — Cód: ${S.ic||''} — Alta: ${S.ia||''} — DFE: ${S.df||'No'}<br>
    <b>Canal:</b> ${S.canal||''} — <b>Regímenes:</b> IVA ${S.iva?'Sí':'No'} · Ganancias ${S.gan?'Sí':'No'} · Autónomos ${S.aut?'Sí':'No'} ${S.autcat?('(Cat '+S.autcat+')'):''} · Empleador ${S.emp?'Sí':'No'} · BP ${S.bp?'Sí':'No'} · Cedulares ${S.ced?'Sí':'No'}<br>
    <b>Fecha:</b> ${S.fecha||'-'}
    </div>`;
  }
  const w=window.open("about:blank"); w.document.write(`<!DOCTYPE html><meta charset="utf-8"><title>Constancia</title><body style="font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:#f5f8fa;padding:24px">${body}<p><button onclick="print()">Imprimir</button></p></body>`);
}

function exportCSV(){
  const rows=(window._rows||[]).map(r=>[r.tipo,r.apellido,r.nombre,r.cuit,r.doc,r.actividad,r.iibb,r.fecha]);
  let csv="tipo,apellido,nombre,CUIT,documento,actividad,IIBB,fecha\n"+rows.map(a=>a.map(x=>`"${String(x??"").replaceAll('"','""')}"`).join(",")).join("\n");
  const url=URL.createObjectURL(new Blob([csv],{type:"text/csv"})), a=document.createElement("a");a.href=url;a.download="registros.csv";a.click();URL.revokeObjectURL(url);
}
function exportXLS(){
  const HEAD=["tipo","apellido","nombre","CUIT","documento","actividad","IIBB","fecha"];
  const esc=s=>String(s??"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
  const rows=(window._rows||[]).map(r=>"<tr>"+HEAD.map(k=>`<td>${esc(r[k.toLowerCase()]||r[k]||"")}</td>`).join("")+"</tr>").join("");
  const html=`<!DOCTYPE html><meta charset="utf-8"><table border="1"><thead><tr>${HEAD.map(h=>`<th>${h}</th>`).join("")}</tr></thead><tbody>${rows}</tbody></table>`;
  const url=URL.createObjectURL(new Blob([html],{type:"application/vnd.ms-excel"})), a=document.createElement("a");a.href=url;a.download="registros.xls";a.click();URL.revokeObjectURL(url);
}

function init(){openLogin()}init();
</script>
</body>
</html>
